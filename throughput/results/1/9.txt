BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%antique%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 266366273.982661
 ALGERIA                   |   1997 | 447472521.122792
 ALGERIA                   |   1996 | 452992748.403403
 ALGERIA                   |   1995 | 456617272.042731
 ALGERIA                   |   1994 | 443924472.636221
 ALGERIA                   |   1993 | 451843631.445735
 ALGERIA                   |   1992 | 451104595.952504
 ARGENTINA                 |   1998 | 279018053.524015
 ARGENTINA                 |   1997 | 472833372.484139
 ARGENTINA                 |   1996 | 468717919.728728
 ARGENTINA                 |   1995 | 473637222.199711
 ARGENTINA                 |   1994 | 471504140.046703
 ARGENTINA                 |   1993 | 467605000.916581
 ARGENTINA                 |   1992 | 472211076.285263
 BRAZIL                    |   1998 | 270272010.379248
 BRAZIL                    |   1997 | 464308599.366711
 BRAZIL                    |   1996 | 459001564.788623
 BRAZIL                    |   1995 | 464236426.575391
 BRAZIL                    |   1994 | 460323497.826457
 BRAZIL                    |   1993 | 459491227.724743
 BRAZIL                    |   1992 | 458891642.684149
 CANADA                    |   1998 | 276953949.625455
 CANADA                    |   1997 |    474019375.569
 CANADA                    |   1996 | 468828943.238841
 CANADA                    |   1995 | 468181768.473957
 CANADA                    |   1994 | 480314882.797874
 CANADA                    |   1993 | 478962350.476556
 CANADA                    |   1992 | 464858893.636151
 CHINA                     |   1998 | 268809028.361756
 CHINA                     |   1997 | 456542098.038851
 CHINA                     |   1996 | 460834050.437034
 CHINA                     |   1995 | 458028025.552824
 CHINA                     |   1994 | 455496348.773572
 CHINA                     |   1993 | 469437912.861506
 CHINA                     |   1992 | 458484703.481517
 EGYPT                     |   1998 | 274712921.072122
 EGYPT                     |   1997 |  469903892.41346
 EGYPT                     |   1996 | 471445510.740185
 EGYPT                     |   1995 | 470920163.103895
 EGYPT                     |   1994 | 467967412.506018
 EGYPT                     |   1993 | 468467520.347333
 EGYPT                     |   1992 | 459416794.711367
 ETHIOPIA                  |   1998 | 264491003.565334
 ETHIOPIA                  |   1997 | 455623782.089831
 ETHIOPIA                  |   1996 | 459857475.095376
 ETHIOPIA                  |   1995 | 456386089.363245
 ETHIOPIA                  |   1994 | 464326112.638149
 ETHIOPIA                  |   1993 | 461555063.032754
 ETHIOPIA                  |   1992 | 455579622.063877
 FRANCE                    |   1998 | 266707004.890721
 FRANCE                    |   1997 | 456167881.665808
 FRANCE                    |   1996 |  455444633.92453
 FRANCE                    |   1995 | 453149722.720893
 FRANCE                    |   1994 | 454087844.120349
 FRANCE                    |   1993 | 453358674.968441
 FRANCE                    |   1992 | 455432382.254186
 GERMANY                   |   1998 | 284830418.547324
 GERMANY                   |   1997 |  472179163.95028
 GERMANY                   |   1996 | 473715281.003656
 GERMANY                   |   1995 |  481918934.73174
 GERMANY                   |   1994 | 470481060.763137
 GERMANY                   |   1993 | 469457139.762272
 GERMANY                   |   1992 | 468303569.246805
 INDIA                     |   1998 | 271748811.023971
 INDIA                     |   1997 | 466359620.901042
 INDIA                     |   1996 | 480641214.479324
 INDIA                     |   1995 | 472197464.975935
 INDIA                     |   1994 |  471946093.44058
 INDIA                     |   1993 | 469625020.520157
 INDIA                     |   1992 | 471988358.385986
 INDONESIA                 |   1998 | 273077916.360004
 INDONESIA                 |   1997 | 463076777.348322
 INDONESIA                 |   1996 | 463197482.754251
 INDONESIA                 |   1995 | 462480792.534485
 INDONESIA                 |   1994 | 469219130.349957
 INDONESIA                 |   1993 | 463911942.475361
 INDONESIA                 |   1992 | 469119566.946891
 IRAN                      |   1998 |  275614071.29349
 IRAN                      |   1997 | 464073412.764396
 IRAN                      |   1996 | 476859403.791718
 IRAN                      |   1995 | 456385338.600702
 IRAN                      |   1994 | 463188877.473991
 IRAN                      |   1993 | 469360430.346817
 IRAN                      |   1992 | 470620114.582867
 IRAQ                      |   1998 | 267242935.205625
 IRAQ                      |   1997 | 455998796.518013
 IRAQ                      |   1996 |  465020984.95972
 IRAQ                      |   1995 | 451605800.438496
 IRAQ                      |   1994 | 453916579.662449
 IRAQ                      |   1993 | 457105336.283379
 IRAQ                      |   1992 | 455250904.844783
 JAPAN                     |   1998 | 272071482.446873
 JAPAN                     |   1997 | 464870282.487234
 JAPAN                     |   1996 | 461241982.406016
 JAPAN                     |   1995 | 467743650.155221
 JAPAN                     |   1994 | 464147455.346892
 JAPAN                     |   1993 | 464660060.876966
 JAPAN                     |   1992 | 459472233.800402
 JORDAN                    |   1998 | 262402537.433387
 JORDAN                    |   1997 | 450530762.591659
 JORDAN                    |   1996 | 448929694.046012
 JORDAN                    |   1995 | 453797836.999785
 JORDAN                    |   1994 | 448479640.530996
 JORDAN                    |   1993 | 454436990.379252
 JORDAN                    |   1992 | 447064992.961853
 KENYA                     |   1998 | 275310897.574459
 KENYA                     |   1997 | 474499956.706327
 KENYA                     |   1996 | 479006155.684077
 KENYA                     |   1995 | 465734227.912775
 KENYA                     |   1994 | 477949791.990737
 KENYA                     |   1993 | 469619031.623412
 KENYA                     |   1992 | 475491757.867407
 MOROCCO                   |   1998 | 270074097.160381
 MOROCCO                   |   1997 | 471793506.900999
 MOROCCO                   |   1996 | 468636679.440985
 MOROCCO                   |   1995 | 463567802.011007
 MOROCCO                   |   1994 | 464684910.993017
 MOROCCO                   |   1993 | 463612466.086237
 MOROCCO                   |   1992 | 473718230.368701
 MOZAMBIQUE                |   1998 | 268426585.777399
 MOZAMBIQUE                |   1997 | 458930776.209304
 MOZAMBIQUE                |   1996 | 457857550.134136
 MOZAMBIQUE                |   1995 |  458772692.20107
 MOZAMBIQUE                |   1994 | 452406328.745429
 MOZAMBIQUE                |   1993 | 456803179.148628
 MOZAMBIQUE                |   1992 | 457010527.028586
 PERU                      |   1998 | 269455203.486529
 PERU                      |   1997 | 450925058.562164
 PERU                      |   1996 |  456104643.24095
 PERU                      |   1995 | 453518929.539195
 PERU                      |   1994 | 451293474.133308
 PERU                      |   1993 | 454790462.406874
 PERU                      |   1992 | 459488686.235287
 ROMANIA                   |   1998 | 271760246.570618
 ROMANIA                   |   1997 | 469091647.069106
 ROMANIA                   |   1996 | 467026250.097518
 ROMANIA                   |   1995 | 467163818.782012
 ROMANIA                   |   1994 | 462818643.115484
 ROMANIA                   |   1993 | 463275181.855837
 ROMANIA                   |   1992 | 459745132.234282
 RUSSIA                    |   1998 | 272608612.859224
 RUSSIA                    |   1997 | 468169588.253714
 RUSSIA                    |   1996 | 474444457.698074
 RUSSIA                    |   1995 | 465473249.680504
 RUSSIA                    |   1994 |   462035429.1873
 RUSSIA                    |   1993 | 466116440.416823
 RUSSIA                    |   1992 | 467624203.963846
 SAUDI ARABIA              |   1998 | 272081202.675792
 SAUDI ARABIA              |   1997 | 464414338.307574
 SAUDI ARABIA              |   1996 | 471225009.921716
 SAUDI ARABIA              |   1995 | 470815318.832775
 SAUDI ARABIA              |   1994 | 470566520.278289
 SAUDI ARABIA              |   1993 | 467146297.886843
 SAUDI ARABIA              |   1992 | 470739341.968997
 UNITED KINGDOM            |   1998 | 274755190.457808
 UNITED KINGDOM            |   1997 | 460727705.156913
 UNITED KINGDOM            |   1996 | 459205684.143826
 UNITED KINGDOM            |   1995 | 459845549.387781
 UNITED KINGDOM            |   1994 | 454287126.976408
 UNITED KINGDOM            |   1993 | 463007460.649141
 UNITED KINGDOM            |   1992 | 460751017.574924
 UNITED STATES             |   1998 | 266597166.839845
 UNITED STATES             |   1997 | 461387145.639137
 UNITED STATES             |   1996 | 466777241.073293
 UNITED STATES             |   1995 | 470672788.289093
 UNITED STATES             |   1994 | 469804293.526652
 UNITED STATES             |   1993 | 463744683.095514
 UNITED STATES             |   1992 | 456803105.587672
 VIETNAM                   |   1998 | 270936276.310306
 VIETNAM                   |   1997 | 462591231.526874
 VIETNAM                   |   1996 | 461253795.299845
 VIETNAM                   |   1995 | 460086949.251683
 VIETNAM                   |   1994 | 467253046.311739
 VIETNAM                   |   1993 | 465189538.102122
 VIETNAM                   |   1992 | 464021240.981849
(175 rows)

COMMIT;
COMMIT
